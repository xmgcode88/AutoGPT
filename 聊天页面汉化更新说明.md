# èŠå¤©é¡µé¢æ±‰åŒ–æ›´æ–°è¯´æ˜

## ğŸ”¥ æ–°å¢æ±‰åŒ–å†…å®¹

æœ¬æ¬¡æ›´æ–°è§£å†³äº†ç”¨æˆ·åé¦ˆçš„æ—¶é—´æ ¼å¼åŒ–é—®é¢˜ï¼Œä»¥åŠæ›´å¤šé—æ¼çš„è‹±æ–‡æ–‡æœ¬ã€‚

### ğŸ“ æ—¶é—´æ ¼å¼åŒ–æ±‰åŒ–

**é—®é¢˜**: æ˜¾ç¤º "less than a minute ago" ç­‰è‹±æ–‡æ—¶é—´æ–‡æœ¬

**è§£å†³æ–¹æ¡ˆ**:
1. ä¿®æ”¹ `/src/lib/utils/time.ts` ä¸­çš„ `formatTimeAgo` å‡½æ•°ï¼Œæ·»åŠ ä¸­æ–‡è¯­è¨€æ”¯æŒ
2. æ›´æ–° `/src/app/(platform)/chat/components/ChatMessage/useChatMessage.ts`ï¼Œä½¿ç”¨æ–°çš„ä¸­æ–‡æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
3. ç°åœ¨æ—¶é—´æ˜¾ç¤ºä¸ºï¼š
   - "åˆšåˆš" (just now)
   - "X åˆ†é’Ÿå‰" (X minutes ago)
   - "X å°æ—¶å‰" (X hours ago)
   - "X å¤©å‰" (X days ago)

### âš ï¸ é”™è¯¯å’ŒçŠ¶æ€æ¶ˆæ¯æ±‰åŒ–

#### ç½‘ç»œçŠ¶æ€
- **Connection restored** â†’ è¿æ¥å·²æ¢å¤
- **You're offline** â†’ æ‚¨å·²ç¦»çº¿
- **Check your internet connection** â†’ è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥
- **You're back online** â†’ æ‚¨å·²é‡æ–°è¿æ¥ç½‘ç»œ

#### è¿æ¥çŠ¶æ€
- **Connection interrupted** â†’ è¿æ¥ä¸­æ–­
- **Retrying in X seconds...** â†’ X ç§’åé‡è¯•...

#### ä¼šè¯ç›¸å…³
- **Session not found** â†’ æœªæ‰¾åˆ°ä¼šè¯
- **Session claimed successfully** â†’ ä¼šè¯è®¤é¢†æˆåŠŸ
- **Your chat history has been saved to your account** â†’ æ‚¨çš„èŠå¤©å†å²å·²ä¿å­˜åˆ°æ‚¨çš„è´¦æˆ·
- **Failed to claim session** â†’ è®¤é¢†ä¼šè¯å¤±è´¥
- **Unable to claim session** â†’ æ— æ³•è®¤é¢†ä¼šè¯

#### é”™è¯¯æ¶ˆæ¯
- **Request aborted** â†’ è¯·æ±‚å·²ä¸­æ­¢
- **Stream error** â†’ æµå¼ä¼ è¾“é”™è¯¯
- **Failed to parse stream chunk** â†’ è§£ææµå¼æ•°æ®å—å¤±è´¥
- **An error occurred** â†’ å‘ç”Ÿé”™è¯¯
- **No results found** â†’ æœªæ‰¾åˆ°ç»“æœ
- **Chat Error** â†’ èŠå¤©é”™è¯¯

### ğŸ”§ æŠ€æœ¯å®ç°

#### 1. æ—¶é—´æ ¼å¼åŒ–å‡½æ•°æ›´æ–°
```typescript
// src/lib/utils/time.ts
export function formatTimeAgo(dateStr: string, locale: string = "en"): string {
  const isZh = locale.toLowerCase().startsWith("zh");

  if (diffMins < 1) return isZh ? "åˆšåˆš" : "just now";
  if (diffMins < SECONDS_PER_MINUTE) return isZh ? `${diffMins} åˆ†é’Ÿå‰` : `${diffMins}m ago`;
  // ... æ›´å¤šæ—¶é—´æ ¼å¼
}
```

#### 2. èŠå¤©æ¶ˆæ¯ç»„ä»¶æ›´æ–°
```typescript
// src/app/(platform)/chat/components/ChatMessage/useChatMessage.ts
const formattedTimestamp = message.timestamp
  ? formatTimeAgo(message.timestamp.toString(), "zh-CN")
  : CHAT_TIME_NOW_ZH;
```

#### 3. å›½é™…åŒ–é…ç½®æ‰©å±•
åœ¨ `/src/app/(platform)/chat/i18n.ts` ä¸­æ–°å¢äº†å®Œæ•´çš„ç¿»è¯‘é…ç½®ï¼š
- æ—¶é—´æ ¼å¼åŒ–ç›¸å…³å¸¸é‡
- ç½‘ç»œçŠ¶æ€æ¶ˆæ¯
- é”™è¯¯å’Œè­¦å‘Šæ¶ˆæ¯
- ä¼šè¯ç®¡ç†æ¶ˆæ¯

### ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

1. `/src/lib/utils/time.ts` - æ—¶é—´æ ¼å¼åŒ–å‡½æ•°æ›´æ–°
2. `/src/app/(platform)/chat/components/ChatMessage/useChatMessage.ts` - æ—¶é—´æˆ³æ±‰åŒ–
3. `/src/app/(platform)/chat/useChatStream.ts` - æµå¼ä¼ è¾“é”™è¯¯æ¶ˆæ¯æ±‰åŒ–
4. `/src/app/(platform)/chat/useChatPage.ts` - ç½‘ç»œçŠ¶æ€æ¶ˆæ¯æ±‰åŒ–
5. `/src/app/(platform)/chat/useChatSession.ts` - ä¼šè¯ç›¸å…³æ¶ˆæ¯æ±‰åŒ–
6. `/src/app/(platform)/chat/components/ChatContainer/useChatContainer.handlers.ts` - é”™è¯¯å¤„ç†æ±‰åŒ–
7. `/src/app/(platform)/chat/components/ChatContainer/createStreamEventDispatcher.ts` - äº‹ä»¶åˆ†å‘å™¨æ±‰åŒ–
8. `/src/app/(platform)/chat/components/ChatContainer/helpers.ts` - å·¥å…·å‡½æ•°æ±‰åŒ–
9. `/src/app/(platform)/chat/i18n.ts` - å›½é™…åŒ–é…ç½®æ–‡ä»¶æ›´æ–°

### âœ… æµ‹è¯•éªŒè¯

- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… å¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ (http://localhost:3001)
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿æŒå®Œæ•´
- âœ… æ—¶é—´æ˜¾ç¤ºæ­£ç¡®æ±‰åŒ–
- âœ… é”™è¯¯æ¶ˆæ¯æ­£ç¡®æ±‰åŒ–
- âœ… çŠ¶æ€æç¤ºæ­£ç¡®æ±‰åŒ–

### ğŸ¯ æ•ˆæœå¯¹æ¯”

**æ›´æ–°å‰**:
- "less than a minute ago"
- "Connection restored"
- "An error occurred"
- "Session not found"

**æ›´æ–°å**:
- "åˆšåˆš"
- "è¿æ¥å·²æ¢å¤"
- "å‘ç”Ÿé”™è¯¯"
- "æœªæ‰¾åˆ°ä¼šè¯"

### ğŸš€ è®¿é—®åœ°å€

æ±‰åŒ–åçš„èŠå¤©é¡µé¢ï¼š**http://localhost:3001/chat**

## ğŸ“ æ€»ç»“

æœ¬æ¬¡æ›´æ–°å½»åº•è§£å†³äº†æ—¶é—´æ ¼å¼åŒ–å’Œå…¶ä»–è‹±æ–‡æ–‡æœ¬çš„æ±‰åŒ–é—®é¢˜ï¼Œä½¿èŠå¤©ç•Œé¢çš„ä¸­æ–‡æ˜¾ç¤ºæ›´åŠ å®Œå–„å’Œç»Ÿä¸€ã€‚æ‰€æœ‰ç”¨æˆ·å¯è§çš„æ–‡æœ¬éƒ½å·²å®Œæˆæ±‰åŒ–ï¼ŒåŒæ—¶ä¿æŒäº†åŸæœ‰åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚